"use strict";(self.webpackChunkwblog=self.webpackChunkwblog||[]).push([[7766],{3671:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"project/xmsz","title":"\u9879\u76ee\u5b9e\u6218","description":"\u63a5\u53e3\u91cd\u8bd5","source":"@site/docs/dev/project/xmsz.md","sourceDirName":"project","slug":"/project/xmsz","permalink":"/en/dev/project/xmsz","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1750217146000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u535a\u5ba2","permalink":"/en/dev/project/wblog"},"next":{"title":"\u5982\u4f55\u89e3\u51b3\u6309\u94ae\u91cd\u590d\u70b9\u51fb\uff1f","permalink":"/en/dev/\u524d\u7aef/note/\u89e3\u51b3"}}');var l=r(25105),s=r(69578);const t={},d="\u9879\u76ee\u5b9e\u6218",c={},a=[{value:"\u63a5\u53e3\u91cd\u8bd5",id:"\u63a5\u53e3\u91cd\u8bd5",level:2},{value:"1 \u66b4\u529b\u8f6e\u56de\u6cd5",id:"1-\u66b4\u529b\u8f6e\u56de\u6cd5",level:4},{value:"\u95ee\u9898\u573a\u666f",id:"\u95ee\u9898\u573a\u666f",level:3},{value:"\u4e8b\u6545\u73b0\u573a",id:"\u4e8b\u6545\u73b0\u573a",level:3},{value:"\u6559\u8bad",id:"\u6559\u8bad",level:3},{value:"\u4fee\u590d\u65b9\u6848",id:"\u4fee\u590d\u65b9\u6848",level:3},{value:"2 Spring Retry",id:"2-spring-retry",level:2},{value:"\u5e94\u7528\u573a\u666f",id:"\u5e94\u7528\u573a\u666f",level:3},{value:"\u914d\u7f6e\u793a\u4f8b",id:"\u914d\u7f6e\u793a\u4f8b",level:3},{value:"\u4f18\u52bf",id:"\u4f18\u52bf",level:3},{value:"3 Resilience4j",id:"3-resilience4j",level:2},{value:"\u9ad8\u9636\u573a\u666f",id:"\u9ad8\u9636\u573a\u666f",level:3},{value:"\u6548\u679c",id:"\u6548\u679c",level:3},{value:"4 MQ \u961f\u5217",id:"4-mq-\u961f\u5217",level:2},{value:"\u9002\u7528\u573a\u666f",id:"\u9002\u7528\u573a\u666f",level:3},{value:"\u5b9e\u73b0\u539f\u7406",id:"\u5b9e\u73b0\u539f\u7406",level:3},{value:"5 \u5b9a\u65f6\u4efb\u52a1",id:"5-\u5b9a\u65f6\u4efb\u52a1",level:2},{value:"\u9002\u7528\u573a\u666f",id:"\u9002\u7528\u573a\u666f-1",level:3},{value:"\u5b9e\u73b0\u793a\u4f8b",id:"\u5b9e\u73b0\u793a\u4f8b",level:3},{value:"6 \u4e24\u9636\u6bb5\u63d0\u4ea4",id:"6-\u4e24\u9636\u6bb5\u63d0\u4ea4",level:2},{value:"\u9002\u7528\u573a\u666f",id:"\u9002\u7528\u573a\u666f-2",level:3},{value:"\u5173\u952e\u5b9e\u73b0",id:"\u5173\u952e\u5b9e\u73b0",level:3},{value:"7 \u5206\u5e03\u5f0f\u9501",id:"7-\u5206\u5e03\u5f0f\u9501",level:2},{value:"\u5e94\u7528\u573a\u666f",id:"\u5e94\u7528\u573a\u666f-1",level:3},{value:"\u5b9e\u73b0\u793a\u4f8b",id:"\u5b9e\u73b0\u793a\u4f8b-1",level:3}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"\u9879\u76ee\u5b9e\u6218",children:"\u9879\u76ee\u5b9e\u6218"})}),"\n",(0,l.jsx)(n.h2,{id:"\u63a5\u53e3\u91cd\u8bd5",children:"\u63a5\u53e3\u91cd\u8bd5"}),"\n",(0,l.jsx)(n.h4,{id:"1-\u66b4\u529b\u8f6e\u56de\u6cd5",children:"1 \u66b4\u529b\u8f6e\u56de\u6cd5"}),"\n",(0,l.jsx)(n.h3,{id:"\u95ee\u9898\u573a\u666f",children:"\u95ee\u9898\u573a\u666f"}),"\n",(0,l.jsx)(n.p,{children:"\u67d0\u5b9e\u4e60\u751f\u5199\u7684\u7528\u6237\u6ce8\u518c\u77ed\u4fe1\u53d1\u9001\u63a5\u53e3\u3002\n\u5728\u4e00\u4e2a while \u5faa\u73af\u4e2d\uff0c\u91cd\u590d\u8c03\u7528\u7b2c\u4e09\u65b9\u7684\u53d1\u77ed\u4fe1\u63a5\u53e3\u7ed9\u7528\u6237\u53d1\u9001\u77ed\u4fe1 \u4ee3\u7801\u5982\u4e0b\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"typescript \npublic void sendSms(String phone) { \n    int retry = 0; \n    while (retry < 5) { // \u65e0\u8111\u5faa\u73af \n        try { \n            smsClient.send(phone); \n            break; \n        } catch (Exception e) { \n            retry++; \n            Thread.sleep(1000); // \u56fa\u5b9a1\u79d2\u7761\u7720 \n        } \n    } \n} \n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u4e8b\u6545\u73b0\u573a",children:"\u4e8b\u6545\u73b0\u573a"}),"\n",(0,l.jsxs)(n.p,{children:["\u67d0\u6b21\u77ed\u4fe1\u670d\u52a1\u5668\u51fa\u73b0\u4e86\u8fc7\u8f7d\u95ee\u9898\uff0c\u5bfc\u81f4\u6240\u6709\u8bf7\u6c42\u90fd\u5ef6\u8fdf\u4e86 3 \u79d2\u3002\n\u8fd9\u4e2a\u66b4\u529b\u5faa\u73af\u7684\u4ee3\u7801\u5728",(0,l.jsx)(n.strong,{children:"0.5 \u79d2\u5185\u540c\u65f6\u53d1\u8d77\u6570\u4e07\u6b21\u91cd\u8bd5"}),"\uff0c\u76f4\u63a5\u6253\u7206\u77ed\u4fe1\u5e73\u53f0\uff0c\u89e6\u53d1\u4e86",(0,l.jsx)(n.strong,{children:"\u7194\u65ad\u5c01\u7981"}),"\uff0c\u8fde\u6b63\u5e38\u8bf7\u6c42\u4e5f\u88ab\u62d2\u7edd\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"\u6559\u8bad",children:"\u6559\u8bad"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u4e0d\u505a\u5ef6\u8fdf\u95f4\u9694\u8c03\u6574\uff1a\u56fa\u5b9a\u95f4\u9694\u5bfc\u81f4\u91cd\u8bd5\u8bf7\u6c42\u96c6\u4e2d\u7206\u53d1"}),"\n",(0,l.jsx)(n.li,{children:"\u65e0\u89c6\u5f02\u5e38\u7c7b\u578b\uff1a\u975e\u4e34\u65f6\u6027\u9519\u8bef\uff08\u5982\u53c2\u6570\u9519\u8bef\uff09\u4e5f\u5c1d\u8bd5\u91cd\u8bd5"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u4fee\u590d\u65b9\u6848",children:"\u4fee\u590d\u65b9\u6848"}),"\n",(0,l.jsx)(n.p,{children:"\u52a0\u4e0a\u968f\u673a\u7684\u91cd\u8bd5\u95f4\u9694\uff0c\u5e76\u8fc7\u6ee4\u4e0d\u53ef\u91cd\u8bd5\u7684\u5f02\u5e38"}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"2-spring-retry",children:"2 Spring Retry"}),"\n",(0,l.jsx)(n.h3,{id:"\u5e94\u7528\u573a\u666f",children:"\u5e94\u7528\u573a\u666f"}),"\n",(0,l.jsxs)(n.p,{children:["Spring Retry \u9002\u7528\u4e8e\u4e2d\u5c0f\u9879\u76ee\uff0c\u901a\u8fc7\u6ce8\u89e3\u5feb\u901f\u5b9e\u73b0\u57fa\u672c\u91cd\u8bd5\u548c\u7194\u65ad\uff08\u5982\u8ba2\u5355\u72b6\u6001\u67e5\u8be2\u63a5\u53e3\uff09\u3002\n\u901a\u8fc7\u58f0\u660e",(0,l.jsx)(n.code,{children:"@Retryable"}),"\u6ce8\u89e3\uff0c\u6765\u5b9e\u73b0\u63a5\u53e3\u91cd\u8bd5\u7684\u529f\u80fd\u3002"]}),"\n",(0,l.jsx)(n.h3,{id:"\u914d\u7f6e\u793a\u4f8b",children:"\u914d\u7f6e\u793a\u4f8b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'@Retryable( \n    value = {TimeoutException.class}, // \u53ea\u91cd\u8bd5\u8d85\u65f6\u5f02\u5e38 \n    maxAttempts = 3, \n    backoff = @Backoff(delay = 1000, multiplier = 2) // 1\u79d2\u21922\u79d2\u21924\u79d2 \n) \npublic boolean queryOrderStatus(String orderId) { \n    return httpClient.get("/order/" + orderId); \n} \n \n@Recover // \u515c\u5e95\u56de\u9000\u65b9\u6cd5 \npublic boolean fallback() { \n    return false;  \n} \n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u4f18\u52bf",children:"\u4f18\u52bf"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u58f0\u660e\u5f0f\u6ce8\u89e3\uff1a\u4ee3\u7801\u7b80\u6d01\uff0c\u4e0e\u4e1a\u52a1\u903b\u8f91\u89e3\u8026"}),"\n",(0,l.jsx)(n.li,{children:"\u6307\u6570\u9000\u907f\uff1a\u81ea\u52a8\u62c9\u957f\u91cd\u8bd5\u95f4\u9694"}),"\n",(0,l.jsxs)(n.li,{children:["\u7194\u65ad\u96c6\u6210\uff1a\u7ed3\u5408",(0,l.jsx)(n.code,{children:"@CircuitBreaker"}),"\u53ef\u5feb\u901f\u963b\u65ad\u5f02\u5e38\u6d41\u91cf"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"3-resilience4j",children:"3 Resilience4j"}),"\n",(0,l.jsx)(n.h3,{id:"\u9ad8\u9636\u573a\u666f",children:"\u9ad8\u9636\u573a\u666f"}),"\n",(0,l.jsx)(n.p,{children:"\u5bf9\u4e8e\u6709\u4e9b\u9700\u8981\u81ea\u5b9a\u4e49\u9000\u907f\u7b97\u6cd5\u3001\u7194\u65ad\u7b56\u7565\u548c\u591a\u5c42\u9632\u62a4\u7684\u5927\u4e2d\u578b\u7cfb\u7edf\uff08\u5982\u652f\u4ed8\u6838\u5fc3\u63a5\u53e3\uff09\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Resilience4j\u3002 ### \u6838\u5fc3\u4ee3\u7801\u5982\u4e0b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'// 1. \u91cd\u8bd5\u914d\u7f6e\uff1a\u6307\u6570\u9000\u907f + \u968f\u673a\u6296\u52a8 \nRetryConfig retryConfig = RetryConfig.custom() \n    .maxAttempts(3) \n    .intervalFunction(IntervalFunction.ofExponentialRandomBackoff( \n        1000L, // \u521d\u59cb\u95f4\u96941\u79d2 \n        2.0,   // \u6307\u6570\u500d\u6570 \n        0.3    // \u968f\u673a\u6296\u52a8\u7cfb\u6570 \n    )) \n    .retryOnException(e -> e instanceof TimeoutException) \n    .build(); \n \n// 2. \u7194\u65ad\u914d\u7f6e\uff1a\u9519\u8bef\u7387\u8d8550%\u65f6\u7194\u65ad \nCircuitBreakerConfig cbConfig = CircuitBreakerConfig.custom() \n    .slidingWindow(10, 10, CircuitBreakerConfig.SlidingWindowType.COUNT_BASED)  \n    .failureRateThreshold(50) \n    .build(); \n \n// \u7ec4\u5408\u4f7f\u7528 \nRetry retry = Retry.of("payment", retryConfig); \nCircuitBreaker cb = CircuitBreaker.of("payment", cbConfig); \n \n// \u6267\u884c\u4e1a\u52a1\u903b\u8f91 \nSupplier<Boolean> supplier = () -> paymentService.pay(); \nSupplier<Boolean> decorated = Decorators.ofSupplier(supplier) \n    .withRetry(retry) \n    .withCircuitBreaker(cb) \n    .decorate(); \n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u6548\u679c",children:"\u6548\u679c"}),"\n",(0,l.jsx)(n.p,{children:'\u67d0\u7535\u5546\u5927\u5382\u4e0a\u7ebf\u6b64\u65b9\u6848\u540e\uff0c\u652f\u4ed8\u63a5\u53e3\u8d85\u65f6\u7387\u4e0b\u964d 60%\uff0c\u4e14\u7194\u65ad\u89e6\u53d1\u9891\u7387\u964d\u4f4e\u8fd1 90%\n\u771f\u6b63\u505a\u5230\u4e86"\u6253\u4e0d\u8fd8\u624b\uff0c\u9a82\u4e0d\u8fd8\u53e3"'}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"4-mq-\u961f\u5217",children:"4 MQ \u961f\u5217"}),"\n",(0,l.jsx)(n.h3,{id:"\u9002\u7528\u573a\u666f",children:"\u9002\u7528\u573a\u666f"}),"\n",(0,l.jsx)(n.p,{children:"\u9ad8\u5e76\u53d1\u3001\u5141\u8bb8\u5ef6\u65f6\u7684\u5f02\u6b65\u573a\u666f\uff08\u5982\u7269\u6d41\u72b6\u6001\u540c\u6b65\uff09"}),"\n",(0,l.jsx)(n.h3,{id:"\u5b9e\u73b0\u539f\u7406",children:"\u5b9e\u73b0\u539f\u7406"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\u9996\u6b21\u8bf7\u6c42\u5931\u8d25\u540e\uff0c\u5c06\u6d88\u606f\u6295\u9012\u81f3\u5ef6\u65f6\u961f\u5217"}),"\n",(0,l.jsx)(n.li,{children:"\u961f\u5217\u6839\u636e\u9884\u8bbe\u7684\u5ef6\u65f6\u65f6\u95f4\uff08\u5982 5 \u79d2\u300130 \u79d2\u30011 \u5206\u949f\uff09\u91cd\u8bd5\u6d88\u8d39"}),"\n",(0,l.jsx)(n.li,{children:"\u82e5\u8fbe\u5230\u6700\u5927\u91cd\u8bd5\u6b21\u6570\uff0c\u5219\u8f6c\u5b58\u81f3\u6b7b\u4fe1\u961f\u5217\uff08\u4eba\u5de5\u5904\u7406\uff09"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"RocketMQ \u4ee3\u7801\u7247\u6bb5\u5982\u4e0b\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'// \u751f\u4ea7\u8005\u53d1\u9001\u5ef6\u65f6\u6d88\u606f \nMessage<String> message = new Message(); \nmessage.setBody("\u8ba2\u5355\u6570\u636e"); \nmessage.setDelayTimeLevel(3); // RocketMQ\u9884\u8bbe\u768410\u79d2\u5ef6\u8fdf\u7ea7\u522b \nrocketMQTemplate.send(message); \n \n// \u6d88\u8d39\u8005\u91cd\u8bd5 \n@RocketMQMessageListener(topic = "DELAY_TOPIC") \npublic class DelayConsumer { \n    @Override \n    public void handleMessage(Message message) { \n        try { \n            syncLogistics(message); \n        } catch (Exception e) { \n            // \u91cd\u8bd5\u6b21\u6570 + 1\uff0c\u5e76\u91cd\u65b0\u53d1\u9001\u5230\u66f4\u9ad8\u5ef6\u8fdf\u7ea7\u522b \n            resendWithDelay(message, retryCount + 1); \n        } \n    } \n} \n'})}),"\n",(0,l.jsx)(n.p,{children:"\u5982\u679c RocketMQ \u7684\u6d88\u8d39\u8005\u6d88\u8d39\u5931\u8d25\uff0c\u4f1a\u81ea\u52a8\u53d1\u8d77\u91cd\u8bd5\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"5-\u5b9a\u65f6\u4efb\u52a1",children:"5 \u5b9a\u65f6\u4efb\u52a1"}),"\n",(0,l.jsx)(n.h3,{id:"\u9002\u7528\u573a\u666f-1",children:"\u9002\u7528\u573a\u666f"}),"\n",(0,l.jsx)(n.p,{children:"\u5bf9\u4e8e\u6709\u4e9b\u4e0d\u9700\u8981\u5b9e\u65f6\u53cd\u9988\uff0c\u5141\u8bb8\u6279\u91cf\u5904\u7406\u7684\u4efb\u52a1\uff08\u5982\u6587\u4ef6\u5bfc\u5165\uff09\u7684\u4e1a\u52a1\u573a\u666f\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5b9a\u65f6\u4efb\u52a1\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"\u5b9e\u73b0\u793a\u4f8b",children:"\u5b9e\u73b0\u793a\u4f8b"}),"\n",(0,l.jsx)(n.p,{children:"\u5728\u8fd9\u91cc\u4ee5 Quartz \u4e3a\u4f8b\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'@Scheduled(cron = "0 0/5 * * * ?") // \u6bcf5\u5206\u949f\u6267\u884c \npublic void retryFailedTasks() { \n    List<FailedTask> list = failedTaskDao.listUnprocessed(5); // \u67e5\u5931\u8d25\u4efb\u52a1 \n    list.forEach(task -> { \n        try { \n            retryTask(task); \n            task.markSuccess(); \n        } catch (Exception e) { \n            task.incrRetryCount(); \n        } \n        failedTaskDao.update(task); \n    }); \n} \n'})}),"\n",(0,l.jsxs)(n.p,{children:["\u987a\u4fbf\u7ed9\u5927\u5bb6\u5206\u4eab\u4e00\u4e0b\uff0c\u6c11\u65cf\u4f01\u4e1a\u5927\u5382",(0,l.jsx)(n.a,{href:"https://jsj.top/f/o38ijj",children:"\u524d\u540e\u7aef\u6d4b\u8bd5"}),"\u635e\u4eba\uff0c\u5f85\u9047\u7ed9\u7684\u8fd8\u4e0d\u9519\uff0c\u611f\u5174\u8da3\u7684\u53ef\u4ee5\u6765\u8bd5\u8bd5\uff01"]}),"\n",(0,l.jsx)(n.h2,{id:"6-\u4e24\u9636\u6bb5\u63d0\u4ea4",children:"6 \u4e24\u9636\u6bb5\u63d0\u4ea4"}),"\n",(0,l.jsx)(n.h3,{id:"\u9002\u7528\u573a\u666f-2",children:"\u9002\u7528\u573a\u666f"}),"\n",(0,l.jsx)(n.p,{children:"\u5bf9\u4e8e\u4e25\u683c\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\u7684\u573a\u666f\uff08\u5982\u8d44\u91d1\u8f6c\u8d26\uff09\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e24\u9636\u6bb5\u63d0\u4ea4\u673a\u5236\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"\u5173\u952e\u5b9e\u73b0",children:"\u5173\u952e\u5b9e\u73b0"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:'\u7b2c\u4e00\u9636\u6bb5\uff1a\u8bb0\u5f55\u64cd\u4f5c\u6d41\u6c34\u5230\u6570\u636e\u5e93\uff08\u72b6\u6001\u4e3a"\u8fdb\u884c\u4e2d"\uff09'}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"\u7b2c\u4e8c\u9636\u6bb5\uff1a\u8c03\u7528\u8fdc\u7a0b\u63a5\u53e3\uff0c\u5e76\u6839\u636e\u7ed3\u679c\u66f4\u65b0\u6d41\u6c34\u72b6\u6001"}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:'\u5b9a\u65f6\u8865\u507f\uff1a\u626b\u63cf\u8d85\u65f6\u7684"\u8fdb\u884c\u4e2d"\u6d41\u6c34\u91cd\u65b0\u63d0\u4ea4 \u5177\u4f53\u4ee3\u7801\u5982\u4e0b'}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'@Transactional \npublic void transfer(TransferRequest req) { \n// 1. \u8bb0\u5f55\u6d41\u6c34 \ntransferRecordDao.create(req, PENDING); \n \n// 2. \u8c03\u7528\u94f6\u884c\u63a5\u53e3 \nboolean success = bankClient.transfer(req); \n \n// 3. \u66f4\u65b0\u6d41\u6c34\u72b6\u6001 \ntransferRecordDao.updateStatus(req.getId(), success ? SUCCESS : FAILED); \n \n// 4. \u5931\u8d25\u8f6c\u5f02\u6b65\u91cd\u8bd5 \nif (!success) { \n    mqTemplate.send("TRANSFER_RETRY_QUEUE", req); \n} \n} \n'})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"7-\u5206\u5e03\u5f0f\u9501",children:"7 \u5206\u5e03\u5f0f\u9501"}),"\n",(0,l.jsx)(n.h3,{id:"\u5e94\u7528\u573a\u666f-1",children:"\u5e94\u7528\u573a\u666f"}),"\n",(0,l.jsx)(n.p,{children:"\u5bf9\u4e8e\u4e00\u4e9b\u591a\u670d\u52a1\u5b9e\u4f8b\u3001\u591a\u7ebf\u7a0b\u73af\u5883\u7684\u9632\u91cd\u590d\u63d0\u4ea4\uff08\u5982\u79d2\u6740\uff09\u7684\u4e1a\u52a1\u573a\u666f\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5206\u5e03\u5f0f\u9501\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"\u5b9e\u73b0\u793a\u4f8b-1",children:"\u5b9e\u73b0\u793a\u4f8b"}),"\n",(0,l.jsx)(n.p,{children:"\u8fd9\u91cc\u4ee5 Redis + Lua \u7684\u5206\u5e03\u5f0f\u9501\u4e3a\u4f8b\uff1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'public boolean retryWithLock(String key, int maxRetry) { \n    String lockKey = "api_retry_lock:" + key; \n    for (int i = 0; i < maxRetry; i++) { \n        // \u5c1d\u8bd5\u83b7\u53d6\u5206\u5e03\u5f0f\u9501 \n        if (redis.setnx(lockKey, "1", 30, TimeUnit.SECONDS)) { \n            try { \n                return callApi(); \n            } finally { \n                redis.delete(lockKey); \n            } \n        } \n        Thread.sleep(1000 * (i + 1)); // \u7b49\u5f85\u91ca\u653e\u9501 \n    } \n    return false; \n} \n'})}),"\n",(0,l.jsx)(n.p,{children:"## \u603b\u7ed3 \u91cd\u8bd5\u5c31\u50cf\u673a\u623f\u91cc\u7684\u706d\u706b\u5668\u2014\u2014\u6c38\u8fdc\u4e0d\u5e0c\u671b\u7528\u5230\u5b83\uff0c\u4f46\u5fc5\u987b\u4fdd\u8bc1\u5173\u952e\u65f6\u523b\u80fd\u6551\u547d\u3002"}),"\n",(0,l.jsx)(n.p,{children:"\u6211\u4eec\u5de5\u4f5c\u4e2d\u9009\u62e9\u54ea\u79cd\u65b9\u6848\uff1f"}),"\n",(0,l.jsx)(n.p,{children:"\u522b\u53ea\u770b\u6280\u672f\u6f6e\u6d41\uff0c\u800c\u8981\u770b\u4e1a\u52a1\u7684\u957f\u77db\u548c\u76fe\u724c\uff0c\u9700\u8981\u54ea\u79cd\u914d\u5408\u3002"}),"\n",(0,l.jsxs)(n.p,{children:["\u6700\u540e\u9001\u5927\u5bb6\u4e00\u53e5\u8bdd\uff1a",(0,l.jsx)(n.strong,{children:"\u7cfb\u7edf\u7a33\u5b9a\u7684\u79d8\u8bc0\uff0c\u662f\u6c38\u8fdc\u5bf9\u91cd\u8bd5\u4fdd\u6301\u656c\u754f\u3002"})]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},69578:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>d});var i=r(58101);const l={},s=i.createContext(l);function t(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);