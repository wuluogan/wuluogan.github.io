<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-dev/java/SpringBoot 实现许可证控制" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">SpringBoot 实现许可证控制 | WBlog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://blog.wlgs.site/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://blog.wlgs.site/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://blog.wlgs.site/en/docs/dev/java/SpringBoot 实现许可证控制"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="SpringBoot 实现许可证控制 | WBlog"><meta data-rh="true" name="description" content="背景与需求"><meta data-rh="true" property="og:description" content="背景与需求"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blog.wlgs.site/en/docs/dev/java/SpringBoot 实现许可证控制"><link data-rh="true" rel="alternate" href="https://blog.wlgs.site/docs/dev/java/SpringBoot 实现许可证控制" hreflang="zh"><link data-rh="true" rel="alternate" href="https://blog.wlgs.site/en/docs/dev/java/SpringBoot 实现许可证控制" hreflang="en"><link data-rh="true" rel="alternate" href="https://blog.wlgs.site/docs/dev/java/SpringBoot 实现许可证控制" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/en/blog/rss.xml" title="WBlog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/blog/atom.xml" title="WBlog Atom Feed">





<script src="/js/donation.js" async></script><link rel="stylesheet" href="/en/assets/css/styles.c5e3deb1.css">
<script src="/en/assets/js/runtime~main.8371ed86.js" defer="defer"></script>
<script src="/en/assets/js/main.b5e0a583.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_CRM7" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><b class="navbar__title text--truncate">WBlog</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/en/blog">Blog</a><a class="navbar__item navbar__link" sidebarid="noteSidebar" href="/en/docs/note">Note</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Book</a><ul class="dropdown__menu"><li><a class="dropdown__link" sidebarid="javaSidebar" href="/en/docs/book/java">Java</a></li><li><a class="dropdown__link" sidebarid="codeSidebar" href="/en/docs/book/code">Code</a></li><li><a class="dropdown__link" sidebarid="foodSidebar" href="/en/docs/book/food">Food</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Tool</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/page?file=md">MD</a></li><li><a class="dropdown__link" href="/en/page?file=dict">Dict</a></li></ul></div><a href="#" class="navbar__item navbar__link donation-link">Tip</a><div class="toggle_ZZEd colorModeToggle_hBtq"><button class="clean-btn toggleButton_by9D toggleButtonDisabled_KL6r" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_wWRv lightToggleIcon_MqLn"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_wWRv darkToggleIcon_i3Nj"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_wWRv systemToggleIcon__88S"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_MWeV"><div class="navbar__search searchBarContainer_tJxS" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_VZxq" value=""><div class="loadingRing_AWsq searchBarLoadingRing_N8KY"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_srg8"><div class="docsWrapper_U8Pi"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_fC5I" type="button"></button><div class="docRoot_gbPH"><main class="docMainContainer_RkYj docMainContainerEnhanced_h5Lp"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_tYIO"><div class="docItemContainer_FQ0X"><article><div class="tocCollapsible_ixBv theme-doc-toc-mobile tocMobile_KDTE"><button type="button" class="clean-btn tocCollapsibleButton_D0Bk">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>SpringBoot 实现许可证控制</h1></header>
<h2 class="anchor anchorWithStickyNavbar_Donx" id="背景与需求">背景与需求<a href="#背景与需求" class="hash-link" aria-label="Direct link to 背景与需求" title="Direct link to 背景与需求">​</a></h2>
<p>在软件开发和商业化过程中，许可证控制是一个不可避免的技术需求。无论是企业级管理系统、桌面应用软件，还是SaaS服务，都需要对软件的使用范围、功能权限和时间限制进行有效管控。</p>
<p>许可证系统的核心价值在于： <strong>保护知识产权</strong>：防止软件被非法复制和分发</p>
<p><strong>商业模式支撑</strong>：支持按功能、按时间的差异化定价</p>
<p><strong>用户管理</strong>：精确控制授权用户和使用范围</p>
<p><strong>合规要求</strong>：满足企业对软件资产管理的需求</p>
<p>本文将介绍一个基于Spring Boot + RSA2048非对称加密的许可证控制系统实现方案，具备硬件绑定、功能权限控制等。</p>
<h2 class="anchor anchorWithStickyNavbar_Donx" id="设计思路">设计思路<a href="#设计思路" class="hash-link" aria-label="Direct link to 设计思路" title="Direct link to 设计思路">​</a></h2>
<h4 class="anchor anchorWithStickyNavbar_Donx" id="技术设计">技术设计<a href="#技术设计" class="hash-link" aria-label="Direct link to 技术设计" title="Direct link to 技术设计">​</a></h4>
<p>许可证系统采用非对称加密的设计思路：厂商使用私钥对许可证信息进行数字签名，客户端使用对应的公钥验证签名的真实性。这种架构的优势在于：</p>
<p><strong>1. 安全性高</strong>：私钥由厂商严格保管，公钥可以随软件分发，即使公钥泄露也无法伪造许可证</p>
<p><strong>2. 部署简单</strong>：无需额外的许可证服务器，支持离线验证</p>
<p><strong>3. 扩展性强</strong>：可以灵活添加各种验证规则和权限控制</p>
<h4 class="anchor anchorWithStickyNavbar_Donx" id="技术选型">技术选型<a href="#技术选型" class="hash-link" aria-label="Direct link to 技术选型" title="Direct link to 技术选型">​</a></h4>
<p><strong>后端技术栈</strong>：</p>
<ul>
<li>Spring Boot 3.x：提供完整的Web服务框架和依赖注入</li>
<li>Java Security API：利用JDK内置的RSA加密算法实现</li>
<li>Jackson：处理JSON序列化和反序列化</li>
</ul>
<p><strong>前端技术栈</strong></p>
<ul>
<li>原生JavaScript：无框架依赖，保持轻量级</li>
<li>TailwindCSS：快速构建现代化UI界面</li>
<li>RESTful API：标准化的前后端交互</li>
</ul>
<p><strong>加密算法</strong>：</p>
<ul>
<li>RSA2048：足够安全的非对称加密强度</li>
<li>SHA256withRSA：数字签名算法</li>
<li>Base64：签名结果编码格式</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_Donx" id="核心功能实现">核心功能实现<a href="#核心功能实现" class="hash-link" aria-label="Direct link to 核心功能实现" title="Direct link to 核心功能实现">​</a></h2>
<h4 class="anchor anchorWithStickyNavbar_Donx" id="硬件指纹获取">硬件指纹获取<a href="#硬件指纹获取" class="hash-link" aria-label="Direct link to 硬件指纹获取" title="Direct link to 硬件指纹获取">​</a></h4>
<p>硬件绑定是许可证系统的重要安全特性，通过获取主板序列号实现设备唯一性识别。</p>
<div class="language-text codeBlockContainer_lFgc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_x5WI"><pre tabindex="0" class="prism-code language-text codeBlock_wUdx thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_H_lr"><span class="token-line" style="color:#393A34"><span class="token plain">@Component </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class HardwareUtil { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final Logger logger = LoggerFactory.getLogger(HardwareUtil.class); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 获取主板序列号，支持Windows和Linux系统 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getMotherboardSerial() { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String os = System.getProperty(&quot;os.name&quot;).toLowerCase(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (os.contains(&quot;windows&quot;)) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return getWindowsMotherboardSerial(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else if (os.contains(&quot;linux&quot;)) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return getLinuxMotherboardSerial(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } else { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger.warn(&quot;不支持的操作系统: {}&quot;, os); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return &quot;UNKNOWN&quot;; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.error(&quot;获取主板序列号失败&quot;, e); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return &quot;UNKNOWN&quot;; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Windows系统通过WMI命令获取主板序列号 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String getWindowsMotherboardSerial() throws Exception { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Process process = Runtime.getRuntime().exec(&quot;wmic baseboard get serialnumber&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        BufferedReader reader = new BufferedReader( </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            new InputStreamReader(process.getInputStream(), StandardCharsets.UTF_8) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String line; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        while ((line = reader.readLine()) != null) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            line = line.trim(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!line.isEmpty() &amp;&amp; !line.equals(&quot;SerialNumber&quot;)) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger.debug(&quot;Windows主板序列号: {}&quot;, line); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return line; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reader.close(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        process.waitFor(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;UNKNOWN&quot;; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * Linux系统通过dmidecode命令获取主板序列号 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String getLinuxMotherboardSerial() throws Exception { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 优先使用dmidecode命令 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Process process = Runtime.getRuntime().exec(&quot;sudo dmidecode -s baseboard-serial-number&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            BufferedReader reader = new BufferedReader( </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new InputStreamReader(process.getInputStream(), StandardCharsets.UTF_8) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String line = reader.readLine(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            reader.close(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            process.waitFor(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (line != null &amp;&amp; !line.trim().isEmpty() &amp;&amp; !line.contains(&quot;Not Specified&quot;)) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger.debug(&quot;Linux主板序列号: {}&quot;, line.trim()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return line.trim(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 备选方案：读取系统文件 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return getLinuxMotherboardFromSys(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.error(&quot;dmidecode命令执行失败&quot;, e); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return getLinuxMotherboardFromSys(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 从/sys/class/dmi/id/board_serial文件读取主板序列号 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String getLinuxMotherboardFromSys() { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Process process = Runtime.getRuntime().exec(&quot;cat /sys/class/dmi/id/board_serial&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            BufferedReader reader = new BufferedReader( </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new InputStreamReader(process.getInputStream(), StandardCharsets.UTF_8) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String line = reader.readLine(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            reader.close(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            process.waitFor(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (line != null &amp;&amp; !line.trim().isEmpty()) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger.debug(&quot;Linux主板序列号(从sys读取): {}&quot;, line.trim()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return line.trim(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.warn(&quot;从/sys文件读取失败&quot;, e); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;UNKNOWN&quot;; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 获取系统信息摘要，用于调试和展示 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getSystemInfo() { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return String.format(&quot;操作系统: %s %s, 架构: %s, 主板序列号: %s&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.getProperty(&quot;os.name&quot;), </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.getProperty(&quot;os.version&quot;), </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.getProperty(&quot;os.arch&quot;), </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            getMotherboardSerial() </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span></code></pre></div></div>
<p>这个实现的关键点</p>
<p><strong>异常处理</strong>：获取失败时返回&quot;UNKNOWN&quot;而不是抛出异常，保证程序稳定性</p>
<p><strong>多重备选</strong>：Linux下优先使用dmidecode，失败时尝试读取sys文件</p>
<p><strong>编码处理</strong>：统一使用UTF-8编码避免乱码问题</p>
<p><strong>日志记录</strong>：详细记录获取过程，便于问题排查</p>
<h4 class="anchor anchorWithStickyNavbar_Donx" id="rsa加密工具类">RSA加密工具类<a href="#rsa加密工具类" class="hash-link" aria-label="Direct link to RSA加密工具类" title="Direct link to RSA加密工具类">​</a></h4>
<p>RSA加密是整个系统的安全基石，需要提供密钥生成、签名、验签等完整功能。</p>
<div class="language-text codeBlockContainer_lFgc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_x5WI"><pre tabindex="0" class="prism-code language-text codeBlock_wUdx thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_H_lr"><span class="token-line" style="color:#393A34"><span class="token plain">@Component </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class RSAUtil { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final Logger logger = LoggerFactory.getLogger(RSAUtil.class); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String ALGORITHM = &quot;RSA&quot;; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String SIGNATURE_ALGORITHM = &quot;SHA256withRSA&quot;; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final int KEY_SIZE = 2048; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 生成RSA密钥对 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public KeyPair generateKeyPair() throws Exception { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        KeyPairGenerator keyGen = KeyPairGenerator.getInstance(ALGORITHM); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        keyGen.initialize(KEY_SIZE); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        KeyPair keyPair = keyGen.generateKeyPair(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger.info(&quot;RSA密钥对生成成功，密钥长度: {} bits&quot;, KEY_SIZE); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return keyPair; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 使用私钥对数据进行数字签名 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String sign(String data, PrivateKey privateKey) throws Exception { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Signature signature = Signature.getInstance(SIGNATURE_ALGORITHM); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signature.initSign(privateKey); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signature.update(data.getBytes(StandardCharsets.UTF_8)); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] signedBytes = signature.sign(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String result = Base64.getEncoder().encodeToString(signedBytes); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger.debug(&quot;数据签名完成，原始数据长度: {}, 签名长度: {}&quot;, data.length(), result.length()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 使用公钥验证数字签名 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public boolean verify(String data, String signatureBase64, PublicKey publicKey) throws Exception { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Signature signature = Signature.getInstance(SIGNATURE_ALGORITHM); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signature.initVerify(publicKey); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        signature.update(data.getBytes(StandardCharsets.UTF_8)); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] signatureBytes = Base64.getDecoder().decode(signatureBase64); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        boolean isValid = signature.verify(signatureBytes); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger.debug(&quot;签名验证结果: {}&quot;, isValid ? &quot;通过&quot; : &quot;失败&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return isValid; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 将私钥转换为PEM格式字符串 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String privateKeyToPem(PrivateKey privateKey) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String encoded = Base64.getEncoder().encodeToString(privateKey.getEncoded()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;-----BEGIN PRIVATE KEY-----\n&quot; + </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                formatBase64String(encoded) + </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;\n-----END PRIVATE KEY-----&quot;; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 将公钥转换为PEM格式字符串 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String publicKeyToPem(PublicKey publicKey) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String encoded = Base64.getEncoder().encodeToString(publicKey.getEncoded()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;-----BEGIN PUBLIC KEY-----\n&quot; + </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                formatBase64String(encoded) + </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;\n-----END PUBLIC KEY-----&quot;; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 从PEM格式字符串加载私钥 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public PrivateKey loadPrivateKeyFromPem(String pemContent) throws Exception { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String privateKeyPEM = pemContent </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .replaceAll(&quot;-----\\w+ PRIVATE KEY-----&quot;, &quot;&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .replaceAll(&quot;\\s&quot;, &quot;&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] decoded = Base64.getDecoder().decode(privateKeyPEM); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        PKCS8EncodedKeySpec spec = new PKCS8EncodedKeySpec(decoded); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        KeyFactory keyFactory = KeyFactory.getInstance(ALGORITHM); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return keyFactory.generatePrivate(spec); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 从PEM格式字符串加载公钥 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public PublicKey loadPublicKeyFromPem(String pemContent) throws Exception { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String publicKeyPEM = pemContent </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .replaceAll(&quot;-----\\w+ PUBLIC KEY-----&quot;, &quot;&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .replaceAll(&quot;\\s&quot;, &quot;&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] decoded = Base64.getDecoder().decode(publicKeyPEM); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        X509EncodedKeySpec spec = new X509EncodedKeySpec(decoded); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        KeyFactory keyFactory = KeyFactory.getInstance(ALGORITHM); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return keyFactory.generatePublic(spec); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 格式化Base64字符串，每64个字符换行 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String formatBase64String(String base64) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        StringBuilder formatted = new StringBuilder(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        for (int i = 0; i &lt; base64.length(); i += 64) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            formatted.append(base64, i, Math.min(i + 64, base64.length())).append(&quot;\n&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return formatted.toString().trim(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_Donx" id="许可证数据模型">许可证数据模型<a href="#许可证数据模型" class="hash-link" aria-label="Direct link to 许可证数据模型" title="Direct link to 许可证数据模型">​</a></h4>
<p>许可证实体类定义了许可证包含的所有信息字段，使用Jackson注解控制JSON序列化顺序。</p>
<div class="language-text codeBlockContainer_lFgc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_x5WI"><pre tabindex="0" class="prism-code language-text codeBlock_wUdx thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_H_lr"><span class="token-line" style="color:#393A34"><span class="token plain">@JsonPropertyOrder({&quot;subject&quot;, &quot;issuedTo&quot;, &quot;hardwareId&quot;, &quot;expireAt&quot;, &quot;features&quot;}) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class License { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String subject;        // 软件产品名称 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String issuedTo;       // 许可证授权对象 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String hardwareId;     // 绑定的硬件指纹 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @JsonFormat(pattern = &quot;yyyy-MM-dd&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private LocalDate expireAt;    // 许可证到期时间 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private List&lt;String&gt; features; // 授权的功能模块列表 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String signature;      // 数字签名（序列化时排除） </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public License() {} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public License(String subject, String issuedTo, String hardwareId, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   LocalDate expireAt, List&lt;String&gt; features) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.subject = subject; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.issuedTo = issuedTo; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.hardwareId = hardwareId; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.expireAt = expireAt; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        this.features = features; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // 完整的getter和setter方法 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getSubject() { return subject; } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setSubject(String subject) { this.subject = subject; } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getIssuedTo() { return issuedTo; } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setIssuedTo(String issuedTo) { this.issuedTo = issuedTo; } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getHardwareId() { return hardwareId; } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setHardwareId(String hardwareId) { this.hardwareId = hardwareId; } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public LocalDate getExpireAt() { return expireAt; } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setExpireAt(LocalDate expireAt) { this.expireAt = expireAt; } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public List&lt;String&gt; getFeatures() { return features; } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setFeatures(List&lt;String&gt; features) { this.features = features; } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String getSignature() { return signature; } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void setSignature(String signature) { this.signature = signature; } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Override </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String toString() { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;License{&quot; + </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;subject=&#x27;&quot; + subject + &#x27;\&#x27;&#x27; + </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;, issuedTo=&#x27;&quot; + issuedTo + &#x27;\&#x27;&#x27; + </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;, hardwareId=&#x27;&quot; + hardwareId + &#x27;\&#x27;&#x27; + </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;, expireAt=&quot; + expireAt + </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;, features=&quot; + features + </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                &#x27;}&#x27;; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_Donx" id="许可证服务核心逻辑">许可证服务核心逻辑<a href="#许可证服务核心逻辑" class="hash-link" aria-label="Direct link to 许可证服务核心逻辑" title="Direct link to 许可证服务核心逻辑">​</a></h4>
<p>许可证服务是整个系统的业务核心，负责许可证的生成和验证逻辑。</p>
<div class="language-text codeBlockContainer_lFgc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_x5WI"><pre tabindex="0" class="prism-code language-text codeBlock_wUdx thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_H_lr"><span class="token-line" style="color:#393A34"><span class="token plain">@Service </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class LicenseService { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final Logger logger = LoggerFactory.getLogger(LicenseService.class); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private RSAUtil rsaUtil; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private HardwareUtil hardwareUtil; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private ObjectMapper objectMapper; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 生成许可证文件 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public String generateLicense(License license, PrivateKey privateKey) throws Exception { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 自动填充硬件指纹 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (license.getHardwareId() == null || license.getHardwareId().isEmpty()) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String hardwareId = hardwareUtil.getMotherboardSerial(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            license.setHardwareId(hardwareId); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.info(&quot;自动获取硬件指纹: {}&quot;, hardwareId); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 创建标准化的JSON数据用于签名 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String licenseData = createStandardizedLicenseJson(license); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger.debug(&quot;待签名的许可证数据: {}&quot;, licenseData); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 使用私钥对许可证数据进行签名 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String signature = rsaUtil.sign(licenseData, privateKey); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 创建包含签名的完整许可证 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        JsonNode jsonNode = objectMapper.readTree(licenseData); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ((ObjectNode) jsonNode).put(&quot;signature&quot;, signature); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        String result = objectMapper.writerWithDefaultPrettyPrinter().writeValueAsString(jsonNode); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger.info(&quot;许可证生成成功，授权给: {}, 到期时间: {}&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   license.getIssuedTo(), license.getExpireAt()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return result; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 验证许可证的有效性 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public LicenseVerifyResult verifyLicense(String licenseJson, PublicKey publicKey) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            JsonNode jsonNode = objectMapper.readTree(licenseJson); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 检查是否包含签名字段 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!jsonNode.has(&quot;signature&quot;)) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return new LicenseVerifyResult(false, &quot;许可证缺少数字签名&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String signature = jsonNode.get(&quot;signature&quot;).asText(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 移除签名字段，重构原始许可证数据 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            ((ObjectNode) jsonNode).remove(&quot;signature&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            License license = objectMapper.readValue(jsonNode.toString(), License.class); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 重新生成标准化的JSON数据用于验证 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String licenseData = createStandardizedLicenseJson(license); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.debug(&quot;验证用许可证数据: {}&quot;, licenseData); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 验证数字签名 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            boolean signatureValid = rsaUtil.verify(licenseData, signature, publicKey); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!signatureValid) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger.warn(&quot;许可证数字签名验证失败&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return new LicenseVerifyResult(false, &quot;许可证数字签名无效&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 验证硬件指纹 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String currentHardwareId = hardwareUtil.getMotherboardSerial(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!currentHardwareId.equals(license.getHardwareId())) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger.warn(&quot;硬件指纹不匹配 - 期望: {}, 实际: {}&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                           license.getHardwareId(), currentHardwareId); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return new LicenseVerifyResult(false, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    String.format(&quot;硬件指纹不匹配。许可证绑定设备: %s, 当前设备: %s&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        license.getHardwareId(), currentHardwareId)); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            // 验证许可证有效期 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (license.getExpireAt().isBefore(LocalDate.now())) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger.warn(&quot;许可证已过期 - 到期时间: {}, 当前时间: {}&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                           license.getExpireAt(), LocalDate.now()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return new LicenseVerifyResult(false, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    String.format(&quot;许可证已过期。到期时间: %s, 当前时间: %s&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        license.getExpireAt(), LocalDate.now())); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.info(&quot;许可证验证通过 - 授权对象: {}, 功能权限: {}&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       license.getIssuedTo(), license.getFeatures()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return new LicenseVerifyResult(true, &quot;许可证验证成功&quot;, license); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.error(&quot;许可证验证过程发生异常&quot;, e); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return new LicenseVerifyResult(false, &quot;许可证格式错误: &quot; + e.getMessage()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 创建标准化的许可证JSON数据 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 手动构建JSON确保字段顺序一致，这是签名验证成功的关键 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String createStandardizedLicenseJson(License license) throws Exception { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        StringBuilder json = new StringBuilder(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        json.append(&quot;{&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        json.append(&quot;\&quot;subject\&quot;:\&quot;&quot;).append(escapeJson(license.getSubject())).append(&quot;\&quot;,&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        json.append(&quot;\&quot;issuedTo\&quot;:\&quot;&quot;).append(escapeJson(license.getIssuedTo())).append(&quot;\&quot;,&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        json.append(&quot;\&quot;hardwareId\&quot;:\&quot;&quot;).append(escapeJson(license.getHardwareId())).append(&quot;\&quot;,&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        json.append(&quot;\&quot;expireAt\&quot;:\&quot;&quot;).append(license.getExpireAt().toString()).append(&quot;\&quot;,&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        json.append(&quot;\&quot;features\&quot;:[&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (license.getFeatures() != null &amp;&amp; !license.getFeatures().isEmpty()) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            for (int i = 0; i &lt; license.getFeatures().size(); i++) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                if (i &gt; 0) json.append(&quot;,&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                json.append(&quot;\&quot;&quot;).append(escapeJson(license.getFeatures().get(i))).append(&quot;\&quot;&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        json.append(&quot;]}&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return json.toString(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 转义JSON字符串中的特殊字符 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private String escapeJson(String str) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (str == null) return &quot;&quot;; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return str.replace(&quot;\\&quot;, &quot;\\\\&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  .replace(&quot;\&quot;&quot;, &quot;\\\&quot;&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  .replace(&quot;\n&quot;, &quot;\\n&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  .replace(&quot;\r&quot;, &quot;\\r&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  .replace(&quot;\t&quot;, &quot;\\t&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 许可证验证结果封装类 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static class LicenseVerifyResult { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private final boolean valid; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private final String message; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        private final License license; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public LicenseVerifyResult(boolean valid, String message) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this(valid, message, null); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public LicenseVerifyResult(boolean valid, String message, License license) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.valid = valid; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.message = message; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.license = license; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public boolean isValid() { return valid; } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public String getMessage() { return message; } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        public License getLicense() { return license; } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span></code></pre></div></div>
<p>这个服务类的关键设计点</p>
<p><strong>标准化JSON序列化</strong>：手动构建JSON确保字段顺序固定，解决Jackson序列化顺序不一致的问题</p>
<p><strong>全面的验证逻辑</strong>：签名、硬件、时间三重验证确保安全性</p>
<p><strong>详细的日志记录</strong>：记录关键操作和异常，便于问题诊 断 <strong>异常处理</strong>：将所有异常转换为业务结果，保证系统稳定性</p>
<h2 class="anchor anchorWithStickyNavbar_Donx" id="rest-api接口设计">REST API接口设计<a href="#rest-api接口设计" class="hash-link" aria-label="Direct link to REST API接口设计" title="Direct link to REST API接口设计">​</a></h2>
<p>为了提供完整的许可证管理功能，设计了一套RESTful API接口。</p>
<div class="language-text codeBlockContainer_lFgc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_x5WI"><pre tabindex="0" class="prism-code language-text codeBlock_wUdx thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_H_lr"><span class="token-line" style="color:#393A34"><span class="token plain">@RestController </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RequestMapping(&quot;/api&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@CrossOrigin(origins = &quot;*&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class LicenseController { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final Logger logger = LoggerFactory.getLogger(LicenseController.class); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private LicenseService licenseService; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private KeyManagementService keyManagementService; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Autowired </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private HardwareUtil hardwareUtil; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 生成新的RSA密钥对 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PostMapping(&quot;/keys/generate&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; generateKeys() { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, String&gt; keys = keyManagementService.generateKeyPair(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, Object&gt; response = new HashMap&lt;&gt;(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.put(&quot;success&quot;, true); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.put(&quot;data&quot;, keys); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.put(&quot;message&quot;, &quot;密钥对生成成功&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.info(&quot;新的RSA密钥对生成成功&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return ResponseEntity.ok(response); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.error(&quot;密钥生成失败&quot;, e); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, Object&gt; response = new HashMap&lt;&gt;(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.put(&quot;success&quot;, false); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.put(&quot;message&quot;, &quot;密钥生成失败: &quot; + e.getMessage()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return ResponseEntity.badRequest().body(response); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 加载RSA密钥 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PostMapping(&quot;/keys/load&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; loadKeys(@RequestBody Map&lt;String, String&gt; request) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String privateKey = request.get(&quot;privateKey&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String publicKey = request.get(&quot;publicKey&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (privateKey != null &amp;&amp; !privateKey.trim().isEmpty()) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                keyManagementService.loadPrivateKey(privateKey); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger.info(&quot;私钥加载成功&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (publicKey != null &amp;&amp; !publicKey.trim().isEmpty()) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                keyManagementService.loadPublicKey(publicKey); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                logger.info(&quot;公钥加载成功&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, Object&gt; response = new HashMap&lt;&gt;(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.put(&quot;success&quot;, true); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.put(&quot;message&quot;, &quot;密钥加载成功&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return ResponseEntity.ok(response); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.error(&quot;密钥加载失败&quot;, e); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, Object&gt; response = new HashMap&lt;&gt;(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.put(&quot;success&quot;, false); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.put(&quot;message&quot;, &quot;密钥加载失败: &quot; + e.getMessage()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return ResponseEntity.badRequest().body(response); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 生成许可证 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PostMapping(&quot;/license/generate&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; generateLicense(@RequestBody License license) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!keyManagementService.isKeysLoaded()) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Map&lt;String, Object&gt; response = new HashMap&lt;&gt;(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                response.put(&quot;success&quot;, false); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                response.put(&quot;message&quot;, &quot;请先生成或加载RSA密钥&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return ResponseEntity.badRequest().body(response); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String licenseJson = licenseService.generateLicense( </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                license, keyManagementService.getCachedPrivateKey()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, Object&gt; response = new HashMap&lt;&gt;(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.put(&quot;success&quot;, true); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.put(&quot;data&quot;, licenseJson); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.put(&quot;message&quot;, &quot;许可证生成成功&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.info(&quot;为 {} 生成许可证成功&quot;, license.getIssuedTo()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return ResponseEntity.ok(response); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.error(&quot;许可证生成失败&quot;, e); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, Object&gt; response = new HashMap&lt;&gt;(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.put(&quot;success&quot;, false); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.put(&quot;message&quot;, &quot;许可证生成失败: &quot; + e.getMessage()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return ResponseEntity.badRequest().body(response); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 验证许可证 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PostMapping(&quot;/license/verify&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; verifyLicense(@RequestBody Map&lt;String, String&gt; request) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            String licenseJson = request.get(&quot;licenseJson&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (licenseJson == null || licenseJson.trim().isEmpty()) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Map&lt;String, Object&gt; response = new HashMap&lt;&gt;(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                response.put(&quot;success&quot;, false); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                response.put(&quot;message&quot;, &quot;许可证内容不能为空&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return ResponseEntity.badRequest().body(response); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!keyManagementService.isKeysLoaded()) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                Map&lt;String, Object&gt; response = new HashMap&lt;&gt;(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                response.put(&quot;success&quot;, false); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                response.put(&quot;message&quot;, &quot;请先加载公钥&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                return ResponseEntity.badRequest().body(response); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            LicenseService.LicenseVerifyResult result = licenseService.verifyLicense( </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                licenseJson, keyManagementService.getCachedPublicKey()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, Object&gt; response = new HashMap&lt;&gt;(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.put(&quot;success&quot;, result.isValid()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.put(&quot;message&quot;, result.getMessage()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (result.getLicense() != null) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                response.put(&quot;license&quot;, result.getLicense()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.info(&quot;许可证验证完成，结果: {}&quot;, result.isValid() ? &quot;通过&quot; : &quot;失败&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return ResponseEntity.ok(response); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (Exception e) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.error(&quot;许可证验证过程异常&quot;, e); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Map&lt;String, Object&gt; response = new HashMap&lt;&gt;(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.put(&quot;success&quot;, false); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            response.put(&quot;message&quot;, &quot;许可证验证失败: &quot; + e.getMessage()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return ResponseEntity.badRequest().body(response); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 获取当前硬件信息 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GetMapping(&quot;/hardware/info&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; getHardwareInfo() { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, Object&gt; response = new HashMap&lt;&gt;(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response.put(&quot;success&quot;, true); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, String&gt; hardwareInfo = new HashMap&lt;&gt;(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hardwareInfo.put(&quot;motherboardSerial&quot;, hardwareUtil.getMotherboardSerial()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hardwareInfo.put(&quot;systemInfo&quot;, hardwareUtil.getSystemInfo()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hardwareInfo.put(&quot;osName&quot;, System.getProperty(&quot;os.name&quot;)); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hardwareInfo.put(&quot;osVersion&quot;, System.getProperty(&quot;os.version&quot;)); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        hardwareInfo.put(&quot;osArch&quot;, System.getProperty(&quot;os.arch&quot;)); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response.put(&quot;data&quot;, hardwareInfo); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger.debug(&quot;硬件信息查询完成&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ResponseEntity.ok(response); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 检查密钥加载状态 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GetMapping(&quot;/keys/status&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;Map&lt;String, Object&gt;&gt; getKeysStatus() { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, Object&gt; response = new HashMap&lt;&gt;(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response.put(&quot;success&quot;, true); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response.put(&quot;keysLoaded&quot;, keyManagementService.isKeysLoaded()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response.put(&quot;hasPrivateKey&quot;, keyManagementService.getCachedPrivateKey() != null); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        response.put(&quot;hasPublicKey&quot;, keyManagementService.getCachedPublicKey() != null); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ResponseEntity.ok(response); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_Donx" id="应用场景与集成">应用场景与集成<a href="#应用场景与集成" class="hash-link" aria-label="Direct link to 应用场景与集成" title="Direct link to 应用场景与集成">​</a></h2>
<h4 class="anchor anchorWithStickyNavbar_Donx" id="许可证文件格式">许可证文件格式<a href="#许可证文件格式" class="hash-link" aria-label="Direct link to 许可证文件格式" title="Direct link to 许可证文件格式">​</a></h4>
<p>生成的许可证是一个标准的JSON文件，包含所有必要的授权信息和数字签名：</p>
<div class="language-text codeBlockContainer_lFgc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_x5WI"><pre tabindex="0" class="prism-code language-text codeBlock_wUdx thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_H_lr"><span class="token-line" style="color:#393A34"><span class="token plain">{ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;subject&quot;: &quot;企业管理系统&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;issuedTo&quot;: &quot;北京某某科技有限公司&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;hardwareId&quot;: &quot;BFEBFBFF000906E9&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;expireAt&quot;: &quot;2025-12-31&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;features&quot;: [&quot;USER_MANAGEMENT&quot;, &quot;REPORT_EXPORT&quot;, &quot;DATA_ANALYSIS&quot;], </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;signature&quot;: &quot;MEUCIQDxxx...完整的Base64签名&quot; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span></code></pre></div></div>
<p>字段说明 <strong>subject</strong>：软件产品的名称或标识</p>
<p><strong>issuedTo</strong>：许可证的授权对象（通常是公司名称）</p>
<p><strong>hardwareId</strong>：绑定的硬件指纹（主板序列号）</p>
<p><strong>expireAt</strong>：许可证的到期日期</p>
<p><strong>features</strong>：授权使用的功能模块列表</p>
<p><strong>signature</strong>：使用私钥生成的数字签名</p>
<h4 class="anchor anchorWithStickyNavbar_Donx" id="功能权限控制">功能权限控制<a href="#功能权限控制" class="hash-link" aria-label="Direct link to 功能权限控制" title="Direct link to 功能权限控制">​</a></h4>
<p>基于许可证的功能权限控制可以通过AOP切面和自定义注解实现</p>
<div class="language-text codeBlockContainer_lFgc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_x5WI"><pre tabindex="0" class="prism-code language-text codeBlock_wUdx thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_H_lr"><span class="token-line" style="color:#393A34"><span class="token plain">@Target({ElementType.METHOD, ElementType.TYPE}) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Retention(RetentionPolicy.RUNTIME) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Documented </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public @interface RequireFeature { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 需要的功能权限 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String value(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    /** </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     * 权限不足时的提示信息 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     */ </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    String message() default &quot;功能未授权&quot;; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Component </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Aspect </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@Order(1) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class LicenseFeatureAspect { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final Logger logger = LoggerFactory.getLogger(LicenseFeatureAspect.class); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @Around(&quot;@annotation(requireFeature)&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public Object checkFeaturePermission(ProceedingJoinPoint joinPoint, RequireFeature requireFeature) throws Throwable { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 获取当前许可证信息 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        License currentLicense = LicenseContext.getCurrentLicense(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (currentLicense == null) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.warn(&quot;访问需要授权的功能，但未找到有效许可证: {}&quot;, requireFeature.value()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new LicenseException(&quot;系统未找到有效许可证，请联系管理员&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 检查功能权限 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (currentLicense.getFeatures() == null || </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            !currentLicense.getFeatures().contains(requireFeature.value())) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            logger.warn(&quot;功能权限不足 - 用户: {}, 需要权限: {}, 拥有权限: {}&quot;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       currentLicense.getIssuedTo(), </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       requireFeature.value(), </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       currentLicense.getFeatures()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new LicenseException(requireFeature.message() + &quot;: &quot; + requireFeature.value()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        logger.debug(&quot;功能权限验证通过: {}&quot;, requireFeature.value()); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return joinPoint.proceed(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 使用示例 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RestController </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">@RequestMapping(&quot;/api/report&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class ReportController { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @GetMapping(&quot;/export&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequireFeature(&quot;REPORT_EXPORT&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;byte[]&gt; exportReport(@RequestParam String format) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 报表导出功能实现 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] reportData = generateReport(format); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        HttpHeaders headers = new HttpHeaders(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        headers.add(&quot;Content-Disposition&quot;, &quot;attachment; filename=report.&quot; + format); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ResponseEntity.ok() </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .headers(headers) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .body(reportData); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @PostMapping(&quot;/schedule&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    @RequireFeature(&quot;REPORT_SCHEDULE&quot;) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public ResponseEntity&lt;String&gt; scheduleReport(@RequestBody ScheduleRequest request) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 定时报表功能实现 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        scheduleReportJob(request); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ResponseEntity.ok(&quot;定时报表创建成功&quot;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_Donx" id="web管理界面">Web管理界面<a href="#web管理界面" class="hash-link" aria-label="Direct link to Web管理界面" title="Direct link to Web管理界面">​</a></h3>
<p>本DEMO提供了一个完整的Web管理界面，具备以下功能：</p>
<p><strong>硬件信息展示</strong>：实时显示当前设备的硬件指纹和系统信息</p>
<p><strong>密钥管理</strong>：生成新的RSA密钥对，或加载现有密钥</p>
<p><strong>许可证生成</strong>：创建包含各种权限的许可证文件</p>
<p><strong>许可证验证</strong>：验证许可证的有效性和权限范围</p>
<p>主要的前端交互逻辑：</p>
<div class="language-text codeBlockContainer_lFgc theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_x5WI"><pre tabindex="0" class="prism-code language-text codeBlock_wUdx thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_H_lr"><span class="token-line" style="color:#393A34"><span class="token plain">// API基础配置 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">const API_BASE = &#x27;http://localhost:8080/api&#x27;; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 页面初始化 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">document.addEventListener(&#x27;DOMContentLoaded&#x27;, function() { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    loadHardwareInfo(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    checkKeyStatus(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    setDefaultExpireDate(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 生成许可证 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">async function generateLicense() { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 收集表单数据 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const licenseData = { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            subject: document.getElementById(&#x27;subject&#x27;).value.trim(), </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            issuedTo: document.getElementById(&#x27;issuedTo&#x27;).value.trim(), </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            expireAt: document.getElementById(&#x27;expireAt&#x27;).value, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            features: document.getElementById(&#x27;features&#x27;).value.trim() </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .split(&#x27;,&#x27;).map(f =&gt; f.trim()).filter(f =&gt; f) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 数据验证 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!licenseData.subject || !licenseData.issuedTo || !licenseData.expireAt) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            showToast(&#x27;警告&#x27;, &#x27;请填写所有必填字段&#x27;, &#x27;warning&#x27;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        showToast(&#x27;处理中&#x27;, &#x27;正在生成许可证...&#x27;, &#x27;info&#x27;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // 调用API生成许可证 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const response = await fetch(`${API_BASE}/license/generate`, { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            method: &#x27;POST&#x27;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            headers: { &#x27;Content-Type&#x27;: &#x27;application/json&#x27; }, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            body: JSON.stringify(licenseData) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const result = await response.json(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (result.success) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            document.getElementById(&#x27;generatedLicense&#x27;).value = result.data; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            showToast(&#x27;成功&#x27;, &#x27;许可证生成成功&#x27;, &#x27;success&#x27;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            showToast(&#x27;错误&#x27;, result.message, &#x27;error&#x27;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } catch (error) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        console.error(&#x27;生成许可证失败:&#x27;, error); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        showToast(&#x27;错误&#x27;, &#x27;网络连接失败&#x27;, &#x27;error&#x27;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 验证许可证 </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">async function verifyLicense() { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    try { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const licenseJson = document.getElementById(&#x27;licenseToVerify&#x27;).value.trim(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (!licenseJson) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            showToast(&#x27;警告&#x27;, &#x27;请输入许可证内容&#x27;, &#x27;warning&#x27;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            return; </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        showToast(&#x27;处理中&#x27;, &#x27;正在验证许可证...&#x27;, &#x27;info&#x27;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const response = await fetch(`${API_BASE}/license/verify`, { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            method: &#x27;POST&#x27;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            headers: { &#x27;Content-Type&#x27;: &#x27;application/json&#x27; }, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            body: JSON.stringify({ licenseJson }) </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        const result = await response.json(); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        displayVerificationResult(result); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } catch (error) { </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        console.error(&#x27;验证许可证失败:&#x27;, error); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        showToast(&#x27;错误&#x27;, &#x27;验证过程出错&#x27;, &#x27;error&#x27;); </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} </span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_Donx" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h2>
<p>本文介绍了一套基于Spring Boot + RSA2048的许可证控制系统实现方案，包含硬件指纹获取、数字签名验证、功能权限控制等核心功能，支持跨平台部署，提供完整的Web示例界面，适用于企业软件的商业化授权控制。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/dev/java/SpringBoot 实现许可证控制.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_w8N_" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_I1LX"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"></nav></div></div><div class="col col--3"><div class="tableOfContents_OqFH thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#背景与需求" class="table-of-contents__link toc-highlight">背景与需求</a></li><li><a href="#设计思路" class="table-of-contents__link toc-highlight">设计思路</a></li><li><a href="#核心功能实现" class="table-of-contents__link toc-highlight">核心功能实现</a></li><li><a href="#rest-api接口设计" class="table-of-contents__link toc-highlight">REST API接口设计</a></li><li><a href="#应用场景与集成" class="table-of-contents__link toc-highlight">应用场景与集成</a><ul><li><a href="#web管理界面" class="table-of-contents__link toc-highlight">Web管理界面</a></li></ul></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025</div></div></div></footer></div>
</body>
</html>