<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-dev/git" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Git 相关 | WBlog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://blog.wlgs.site/en/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://blog.wlgs.site/en/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://blog.wlgs.site/en/note/dev/git"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" property="og:locale:alternate" content="zh"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Git 相关 | WBlog"><meta data-rh="true" name="description" content="通过Github Action宝塔实现自动部署Node项目"><meta data-rh="true" property="og:description" content="通过Github Action宝塔实现自动部署Node项目"><link data-rh="true" rel="icon" href="/en/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://blog.wlgs.site/en/note/dev/git"><link data-rh="true" rel="alternate" href="https://blog.wlgs.site/note/dev/git" hreflang="zh"><link data-rh="true" rel="alternate" href="https://blog.wlgs.site/en/note/dev/git" hreflang="en"><link data-rh="true" rel="alternate" href="https://blog.wlgs.site/note/dev/git" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/en/blog/rss.xml" title="WBlog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/blog/atom.xml" title="WBlog Atom Feed">
<link rel="alternate" type="application/rss+xml" href="/en/week/rss.xml" title="WBlog Weekly RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/week/atom.xml" title="WBlog Weekly Atom Feed">




<script src="/js/donation.js" async></script><link rel="stylesheet" href="/en/assets/css/styles.843975c7.css">
<script src="/en/assets/js/runtime~main.99da7d84.js" defer="defer"></script>
<script src="/en/assets/js/main.ae22a421.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_drrF" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><b class="navbar__title text--truncate">WBlog</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/en/blog">博客</a><a class="navbar__item navbar__link" href="/en/week">周刊</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">知识库</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/en/note">笔记</a></li><li><a class="dropdown__link" href="/en/dev">开发</a></li><li><a class="dropdown__link" href="/en/book">手册</a></li></ul></div><a href="#" class="navbar__item navbar__link donation-link">打赏</a><div class="toggle_hRRL colorModeToggle_Yiz2"><button class="clean-btn toggleButton_dUTx toggleButtonDisabled_miDb" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_ivqA"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_LEm1"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_k6Vh"><div class="navbar__search searchBarContainer_dAjJ" dir="ltr"><input placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_dCDV" value=""><div class="loadingRing_DbUE searchBarLoadingRing__ACM"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_ZXxP"><div class="docsWrapper_WbYh"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_LLwe" type="button"></button><div class="docRoot_tsap"><aside class="theme-doc-sidebar-container docSidebarContainer_rjm8"><div class="sidebarViewport_felT"><div class="sidebar_nuaA"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_Qtm4"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/en/note/">今天我学了什么 (Today I Learned)</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/en/note/category/config">Config</a><button aria-label="Expand sidebar category &#x27;Config&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/en/note/dev/docker/docker-compose">dev</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/en/note/dev/docker/docker-compose">docker</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/note/dev/git">Git 相关</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/en/note/dev/java/java-solon">java</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/en/note/dev/tool/trae">tool</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/en/note/draw/hln">draw</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/en/note/food/食谱">food</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/en/note/tool/iptv">tool</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/en/note/www/down">www</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/en/note/乐趣/mofang">乐趣</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/en/note/网络/网站">网络</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/en/note/运维/域名">运维</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_fQiS"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_uUuA"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_BvAN"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zioE"><div class="docItemContainer_HjW0"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_TKJy" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/en/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_mBth"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">dev</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Git 相关</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_Ej9E theme-doc-toc-mobile tocMobile_Hp1c"><button type="button" class="clean-btn tocCollapsibleButton_Ye87">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Git 相关</h1></header>
<h2 class="anchor anchorWithStickyNavbar_jpdk" id="通过github-action宝塔实现自动部署node项目">通过Github Action宝塔实现自动部署Node项目<a href="#通过github-action宝塔实现自动部署node项目" class="hash-link" aria-label="Direct link to 通过Github Action宝塔实现自动部署Node项目" title="Direct link to 通过Github Action宝塔实现自动部署Node项目">​</a></h2>
<p>如果想实现node项目的CICD自动部署，可以通过Github Action进行自动构建，构建之后，上传到宝塔服务器中，之后进行重启项目。</p>
<h4 class="anchor anchorWithStickyNavbar_jpdk" id="配置宝塔的项目">配置宝塔的项目<a href="#配置宝塔的项目" class="hash-link" aria-label="Direct link to 配置宝塔的项目" title="Direct link to 配置宝塔的项目">​</a></h4>
<p>第一步：</p>
<p>在宝塔中Node项目管理中配置项目的基础信息。这一步都是可视化操作，不再过多叙述</p>
<p>需要注意的是项目名称，之后的步骤需要用到</p>
<h4 class="anchor anchorWithStickyNavbar_jpdk" id="配置github-action">配置Github Action<a href="#配置github-action" class="hash-link" aria-label="Direct link to 配置Github Action" title="Direct link to 配置Github Action">​</a></h4>
<p>我们的流水线需要用到ssh登录服务器，所以需要ssh私钥配置在github action Secrets中</p>
<p>在Github的项目页中，找到settings-&gt;Secrets and variables-&gt;Actions</p>
<p>点击New repository secret 创建一个新的秘密字符串</p>
<p>名字填SERVER_SSH_KEY</p>
<p>值填你的服务器的ssh私钥。</p>
<h4 class="anchor anchorWithStickyNavbar_jpdk" id="配置流水线">配置流水线<a href="#配置流水线" class="hash-link" aria-label="Direct link to 配置流水线" title="Direct link to 配置流水线">​</a></h4>
<p>在node项目下新建文件夹<code>.github</code> <code>.github</code>文件夹下新建文件夹<code>workflows</code> <code>workflows</code>下新建文件 <code>node.yml</code></p>
<p>写入以下内容</p>
<div class="codeBlockContainer_rxDN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_e6Y8"><pre tabindex="0" class="prism-code language-text codeBlock_eEse thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Uz_K"><span class="token-line" style="color:#393A34"><span class="token plain"># This workflow will do a clean install of node dependencies, cache/restore them, build the source code and run tests across different versions of node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># For more information see: https://help.github.com/actions/language-and-framework-guides/using-nodejs-with-github-actions</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">name: Node CI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">on:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  push:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	  branches:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		- main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jobs:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  build:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    runs-on: ubuntu-latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    strategy:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      matrix:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        node-version: [18.x]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        # See supported Node.js release schedule at https://nodejs.org/en/about/releases/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    steps:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - uses: actions/checkout@v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: Use Node.js ${{ matrix.node-version }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uses: actions/setup-node@v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        with:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          node-version: ${{ matrix.node-version }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - uses: pnpm/action-setup@v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        with:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          cache: &#x27;pnpm&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - run: pnpm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - run: pnpm run build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - name: Deploy to Staging server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        uses: easingthemes/ssh-deploy@main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        env:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          SSH_PRIVATE_KEY: ${{ secrets.SERVER_SSH_KEY }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          SOURCE: &#x27;dist/&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          REMOTE_HOST: 这里填你的服务器地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          REMOTE_USER: 这里填root或者其他ssh用户名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          REMOTE_PORT: 这里填ssh登录的端口，默认是22</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          TARGET: 这里填你配置的node项目的路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          SCRIPT_AFTER: lsof -i :3100 -t | xargs kill -9 &amp;&amp; sh /www/server/nodejs/vhost/scripts/项目名.sh</span><br></span></code></pre><div class="buttonGroup_Aaa5"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_rNxk" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_8vl6"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uXRx"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上面的地方有一些需要按照你的情况进行修改，不要照抄</p>
<div class="codeBlockContainer_rxDN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_e6Y8"><pre tabindex="0" class="prism-code language-text codeBlock_eEse thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Uz_K"><span class="token-line" style="color:#393A34"><span class="token plain">on:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  push:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">	  branches:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">		- main</span><br></span></code></pre><div class="buttonGroup_Aaa5"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_rNxk" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_8vl6"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uXRx"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里的触发条件完全看你的选择</p>
<div class="codeBlockContainer_rxDN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_e6Y8"><pre tabindex="0" class="prism-code language-text codeBlock_eEse thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Uz_K"><span class="token-line" style="color:#393A34"><span class="token plain">      - run: pnpm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - run: pnpm run build</span><br></span></code></pre><div class="buttonGroup_Aaa5"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_rNxk" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_8vl6"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uXRx"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>复制</p>
<p>我这里使用了pnpm 进行项目的构建，如果你有其他的方式，请修改这里和之前的pnpm命令</p>
<div class="codeBlockContainer_rxDN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_e6Y8"><pre tabindex="0" class="prism-code language-text codeBlock_eEse thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Uz_K"><span class="token-line" style="color:#393A34"><span class="token plain">env:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          SSH_PRIVATE_KEY: ${{ secrets.SERVER_SSH_KEY }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          SOURCE: &#x27;dist/&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          REMOTE_HOST: 这里填你的服务器地址</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          REMOTE_USER: 这里填root或者其他ssh用户名</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          REMOTE_PORT: 这里填ssh登录的端口，默认是22</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          TARGET: 这里填你配置的node项目的路径</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          SCRIPT_AFTER: lsof -i :3100 -t | xargs kill -9 &amp;&amp; sh /www/server/nodejs/vhost/scripts/项目名.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><br></span></code></pre><div class="buttonGroup_Aaa5"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_rNxk" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_8vl6"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uXRx"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>复制</p>
<p>上面的参数中，source是构建之后的node项目的文件夹地址，按照你的项目的实际情况进行修改。</p>
<p>服务器的地址需要注意不要暴露，如果你的项目是私有的，可以直接写，如果是公有的，建议写在<code>secret</code>中。</p>
<p>target 是你的宝塔项目的地址。</p>
<p>SCRIPT_AFTER这里需要注意，首先需要根据端口kill掉原来的进程，你也可以采用其他的方式kill掉进程。我这里写的项目端口是3100。</p>
<p>sh中最后一级的文件名，填你的项目名.sh 这个文件是宝塔用来启动项目的。</p>
<h4 class="anchor anchorWithStickyNavbar_jpdk" id="最后">最后<a href="#最后" class="hash-link" aria-label="Direct link to 最后" title="Direct link to 最后">​</a></h4>
<p>配置完成之后，提交代码触发流水线的构建，之后，github action中会把构建完的文件上传到服务器中，再执行命令杀掉程序，然后重启。</p>
<h2 class="anchor anchorWithStickyNavbar_jpdk" id="如何正确拉取超大体积的git项目">如何正确拉取超大体积的git项目<a href="#如何正确拉取超大体积的git项目" class="hash-link" aria-label="Direct link to 如何正确拉取超大体积的git项目" title="Direct link to 如何正确拉取超大体积的git项目">​</a></h2>
<p>最近遇到一个体积相当大的仓库（40GB+），结果在安利给群内小伙伴时，很多人遇到了直接使用 <code>git clone</code> 克隆仓库到本地时，对本地网络的稳定性有巨大挑战，一旦网络波动导致传输中断，就只能从头下载。
很多人拉项目时习惯<code>git clone</code>一把梭哈，这并不是一个很好的习惯，众所周知国内访问github属于玄学，而且有些项目非常大，搞不好需要好几个小时才能拉取完，长时间+不稳定的网络，很容易出意外。本文就是介绍两种应对超大体积项目的拉取的办法「Git LFS」和「Git fetch」。</p>
<p>Git 的 <code>git clone</code> 命令本身是不直接支持断点续传的，<code>git clone</code> 本质上是创建一个新仓库，并一次性拉取远程所有数据（包括提交历史、分支、标签等）。如果中途中断本地目录会处于不完整状态，直接重试 git clone 会失败，如果你退出终端本地目录也会被清空。</p>
<h3 class="anchor anchorWithStickyNavbar_jpdk" id="使用-git-large-file-storagegit-lfs">使用 Git Large File Storage（Git LFS）<a href="#使用-git-large-file-storagegit-lfs" class="hash-link" aria-label="Direct link to 使用 Git Large File Storage（Git LFS）" title="Direct link to 使用 Git Large File Storage（Git LFS）">​</a></h3>
<p>Git Large File Storage（Git LFS）是一个用于管理大型文件的Git扩展工具，旨在解决Git原生对大文件支持不足的问题。</p>
<p><strong>Git LFS 优点</strong></p>
<ul>
<li>Git LFS用轻量级文本指针（如oid sha256:…）替换实际大文件，避免仓库臃肿。</li>
<li>大文件内容存储在专用服务器（如GitHub LFS、块储存、自建储存、CDN），仅按需下载。</li>
<li>支持单个文件GB级别存储，突破Git对文件大小的限制。（比如 github 是单文件小于100MB，单文件大于50MB会出现警告）</li>
<li>因为大文件实际是分离储存的，可以优化拉取速度。</li>
<li>安装Git LFS 并配置好后，日常 git 操作时，几乎是无感的，Git LFS 会自动处理大文件。</li>
</ul>
<p><strong>Git LFS 缺点</strong></p>
<ul>
<li>需要项目创建者配合从一开始就使用 Git LFS，如果项目没有采用，对于想要克隆拉取项目的人是没有办法去使用 Git LFS 的。</li>
<li>额外的大文件储存和下载都是需要开发者额外掏钱的，像是GitHub就只有10 GiB的免费空间和流量可用，超过的部分需要额外收费。（如果你是pth之类的AI模型文件，huggingface之类的平台给了免费的 LFS 空间）</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_jpdk" id="用-git-fetch-分步拉取">用 git fetch 分步拉取<a href="#用-git-fetch-分步拉取" class="hash-link" aria-label="Direct link to 用 git fetch 分步拉取" title="Direct link to 用 git fetch 分步拉取">​</a></h3>
<p><strong>简单介绍一下 git fetch 分步拉取</strong></p>
<p>Git LFS 更多面对的是项目中部分文件体积很大的情况，比如Unity项目中的.asset文件、PSD源文件、CSV数据集。但还有一种情况，项目中每个文件体积都不大，可能只有几兆到十几兆，但是项目中文件数量极多，几百上千个，加到一起后整个项目体积也到了 GB 规模。这个时候更适合分步拉取的方式。</p>
<p><strong>和 git clone 相比 git fetch 的优势</strong></p>
<ul>
<li>git fetch 基于 Git 对象模型，天然支持断点续传。</li>
<li>即使多次中断，只要本地 .git 目录未损坏，均可通过反复执行 git fetch 逐步补全数据。</li>
<li>如果中断期间远程仓库新增了提交，git fetch 会同时下载新增内容和未完成的旧内容，最终保持本地与远程一致。</li>
</ul>
<p><strong>和 git clone 相比 git fetch 的缺点</strong></p>
<p>除了操作稍微多了几个步骤，没任何额外的缺点。</p>
<p><strong>git fetch 分布拉取的方法</strong></p>
<p>先手动创建空仓库并构建<code>.git</code>文件</p>
<div class="language-bash codeBlockContainer_rxDN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_e6Y8"><pre tabindex="0" class="prism-code language-bash codeBlock_eEse thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Uz_K"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir your-repo &amp;&amp; cd your-repo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git remote add origin https://github.com/user/repo.git</span><br></span></code></pre><div class="buttonGroup_Aaa5"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_rNxk" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_8vl6"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uXRx"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>分步拉取数据</p>
<div class="language-bash codeBlockContainer_rxDN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_e6Y8"><pre tabindex="0" class="prism-code language-bash codeBlock_eEse thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Uz_K"><span class="token-line" style="color:#393A34"><span class="token plain">git fetch origin --progress  # 如果中间传输中断，就在目录下再执行一次这个命令即可。</span><br></span></code></pre><div class="buttonGroup_Aaa5"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_rNxk" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_8vl6"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uXRx"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>等待拉取完毕(以下仅为举例，请根据实现终端显示为准)，这时候项目所有内容都会被打包在<code>.git/objects/pack</code>目录下的<code>.pack</code>文件内。</p>
<div class="language-bash codeBlockContainer_rxDN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_e6Y8"><pre tabindex="0" class="prism-code language-bash codeBlock_eEse thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Uz_K"><span class="token-line" style="color:#393A34"><span class="token plain">Resolving deltas: 100% (9999/9999), done.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">From https://github.com/user/repo.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * [new branch]      master     -&gt; origin/master</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * [new tag]         v1.0       -&gt; v1.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * [new tag]         v1.1       -&gt; v1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * [new tag]         v1.2       -&gt; v1.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * [new tag]         v2.0       -&gt; v2.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * [new tag]         v2.1       -&gt; v2.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * [new tag]         v2.2       -&gt; v2.2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * [new tag]         v2.3       -&gt; v2.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * [new tag]         v2.4       -&gt; v2.4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> * [new tag]         v3.0       -&gt; v3.0</span><br></span></code></pre><div class="buttonGroup_Aaa5"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_rNxk" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_8vl6"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uXRx"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>将需要的分支检出，比如我们检出 master 主分支。</p>
<div class="language-bash codeBlockContainer_rxDN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_e6Y8"><pre tabindex="0" class="prism-code language-bash codeBlock_eEse thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Uz_K"><span class="token-line" style="color:#393A34"><span class="token plain">git checkout master</span><br></span></code></pre><div class="buttonGroup_Aaa5"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_rNxk" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_8vl6"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uXRx"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>其他优化建议</p>
<p>使用浅克隆减少首次下载量，比如只拉取最新分支</p>
<div class="language-bash codeBlockContainer_rxDN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_e6Y8"><pre tabindex="0" class="prism-code language-bash codeBlock_eEse thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Uz_K"><span class="token-line" style="color:#393A34"><span class="token plain">git clone --depth 1 https://github.com/user/repo.git</span><br></span></code></pre><div class="buttonGroup_Aaa5"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_rNxk" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_8vl6"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uXRx"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>之后再补全历史（或者就干脆不补全，节约点空间）</p>
<div class="language-bash codeBlockContainer_rxDN theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_e6Y8"><pre tabindex="0" class="prism-code language-bash codeBlock_eEse thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_Uz_K"><span class="token-line" style="color:#393A34"><span class="token plain">git fetch --unshallow</span><br></span></code></pre><div class="buttonGroup_Aaa5"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_rNxk" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_8vl6"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_uXRx"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_jpdk" id="总结">总结<a href="#总结" class="hash-link" aria-label="Direct link to 总结" title="Direct link to 总结">​</a></h3>
<p>总的来说 Git LFS 主要是应对项目中出现几个巨大体积文件的情况，git fetch 主要是应对一次开机无法完成下载的超大型仓库或不稳定网络环境，比直接 git clone 一把梭哈更加灵活。</p>
<p>PS：顺带提一嘴，如果多次中断和重新拉取，可能会在<code>.git/objects/pack</code>目录下出现很多个.pack文件。如果需要清理的的话，在项目目录下执行<code>git gc --auto</code>。不用在意.pack文件的巨大体积，因为工作目录下你看到的具体文件，是通过硬链接、符号链接构建的，工作目录内的文件和 .pack 中的对象共享同一份数据，并不会真实占用双倍物理空间。实际占用大概是1.2~1.3倍空间，因为.pack文件还是有一定的压缩的。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"></div><div class="col lastUpdated_s8BN"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-05-20T07:35:24.000Z" itemprop="dateModified">May 20, 2025</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/en/note/dev/docker/docker-compose"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Docker Compose</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/en/note/dev/java/java-solon"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Solon</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_tfpF thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#通过github-action宝塔实现自动部署node项目" class="table-of-contents__link toc-highlight">通过Github Action宝塔实现自动部署Node项目</a></li><li><a href="#如何正确拉取超大体积的git项目" class="table-of-contents__link toc-highlight">如何正确拉取超大体积的git项目</a><ul><li><a href="#使用-git-large-file-storagegit-lfs" class="table-of-contents__link toc-highlight">使用 Git Large File Storage（Git LFS）</a></li><li><a href="#用-git-fetch-分步拉取" class="table-of-contents__link toc-highlight">用 git fetch 分步拉取</a></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">© 2025</div></div></div></footer></div>
</body>
</html>